<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <style>
        /* স্টাইল কোড আগের মতোই আছে */
        body { font-family: sans-serif; background-color: #f0f2f5; color: #333; margin: 0; padding: 15px; }
        .dashboard { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); text-align: center; }
        .balance { font-size: 28px; font-weight: bold; color: #007bff; margin: 10px 0; }
        .stats { display: flex; justify-content: space-around; margin: 20px 0; }
        .stat-item { flex-basis: 45%; background: #f8f9fa; padding: 10px; border-radius: 8px; }
        .stat-item h4 { margin: 0 0 5px 0; }
        .stat-item p { margin: 0; font-size: 20px; font-weight: bold; }
        .loader { font-size: 18px; color: #888; }
    </style>
</head>
<body>

    <div class="dashboard">
        <h2 id="welcome-message">লোড হচ্ছে...</h2>
        <p>আপনার বর্তমান ব্যালেন্স:</p>
        <div class="balance">৳ <span id="user-balance" class="loader">...</span></div>

        <div class="stats">
            <div class="stat-item">
                <h4>দৈনিক কাজ সম্পন্ন</h4>
                <p id="daily-tasks">0 / 10</p>
            </div>
            <div class="stat-item">
                <h4>মোট রেফারেল</h4>
                <p id="total-referrals" class="loader">...</p>
            </div>
        </div>

        <h4>আপনার রেফারেল লিঙ্ক</h4>
        <p>আপনার বন্ধুদের রেফার করে আয় করুন!</p>
        <input type="text" id="referral-link" value="লিঙ্ক লোড হচ্ছে..." readonly style="width: 90%; padding: 8px; border-radius: 5px; border: 1px solid #ccc; text-align: center;">
    </div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const tg = window.Telegram.WebApp;
            tg.ready(); // টেলিগ্রামকে জানানো হচ্ছে যে অ্যাপটি প্রস্তুত

            // Python বট-এর API সার্ভারের URL
            // এই URL টি আপনার Pydroid-এ চলমান বট সার্ভারের দিকে নির্দেশ করে
            const API_URL = "https://solve-jessica-inclusion-sometimes.trycloudflare.com";

            // Python বট থেকে ব্যবহারকারীর তথ্য আনার জন্য একটি ফাংশন
            async function fetchUserData() {
                try {
                    // আমাদের Python API-কে অনুরোধ পাঠানো হচ্ছে
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: tg.initData // টেলিগ্রামের দেওয়া সিকিওর ডেটা পাঠানো হচ্ছে
                    });

                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }

                    const data = await response.json();
                    
                    // পাওয়া তথ্য দিয়ে ড্যাশবোর্ড আপডেট করা হচ্ছে
                    document.getElementById('welcome-message').innerText = `স্বাগতম, ${data.full_name}!`;
                    document.getElementById('user-balance').innerText = data.balance;
                    document.getElementById('total-referrals').innerText = data.referrals;
                    
                    // রেফারেল লিঙ্ক তৈরি করা (আমরা পরে এটি সম্পূর্ণ করবো)
                    const botUsername = "Daily_Income_Official_bot"; // আপনার বটের ইউজারনেম
                    const userId = tg.initDataUnsafe.user.id;
                    document.getElementById('referral-link').value = `https://t.me/${botUsername}?start=${userId}`;

                } catch (error) {
                    console.error('Failed to fetch user data:', error);
                    document.getElementById('welcome-message').innerText = "ডেটা লোড করা যায়নি।";
                }
            }
            
            // ফাংশনটি কল করা হচ্ছে
            fetchUserData();
        });
    </script>
    
</body>
</html>
